<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="FinSightRD">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>28.Apache Solr - JanusGraph 翻译版(0.3.1)</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "28.Apache Solr";
    var mkdocs_page_input_path = "index_backends/apache_solr.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> JanusGraph 翻译版(0.3.1)</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">首页</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">I. 介绍</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../introduction/the_benefits_of_janusgraph/">1.JanusGraph优势</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/architectural_overview/">2.架构总览</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/getting_started/">3.开始</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">II. Janusgraph基础知识</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/configuration/">4.基本配置</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/schema_and_data_modeling/">5.数据实例和数据模型</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/gremlin_query_language/">6.Gremin查询语言</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/janusgraph_server/">7.JanusGraph服务</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/deployment_scenarios/">8.部署方案</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/configuredgraphfactory/">9.配置图工厂</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/things_to_consider_in_a_multi_node_janusgraph_cluster/">10.多节点JanusGraph集群中需要考虑的事项</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/indexing_for_better_performance/">11.高性能索引</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/transactions/">12.事务</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/janusgraph_cache/">13.JanusGraph缓存</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/transaction_log/">14.JanusGraph日志</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/configuration_reference/">15.配置手册</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/common_questions/">16.常见问题</a>
                </li>
                <li class="">
                    
    <a class="" href="../../janusgraph_basics/technical_limitations/">17.技术限制</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">III. 存储后端</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../storage_backend/apache_cassandra/">18.Apache Cassandra</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage_backend/apache_hbase/">19.Apache Hbase</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage_backend/goole_cloud_bigtable/">20.Google Cloud Bigtable</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage_backend/oracle_berkeley_DB_java/">21.Oracle Berkeley DB Java Edition</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage_backend/inmemory_storage_backend/">22.内存存储后端</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">IV. 后端索引</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../search_predicates_and_data_types/">23.查询语法和数据类型</a>
                </li>
                <li class="">
                    
    <a class="" href="../index_parameters_and_full-text_search/">24.索引参数和全文搜索</a>
                </li>
                <li class="">
                    
    <a class="" href="../field_mapping/">25.字段映射</a>
                </li>
                <li class="">
                    
    <a class="" href="../direct_index_query/">26.直接索引查询</a>
                </li>
                <li class="">
                    
    <a class="" href="../elasticsearch/">27.Elasticsearch</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">28.Apache Solr</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#28-apache-solr">第28章 Apache Solr</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#281-solr">28.1 Solr配置概述</a></li>
        
            <li><a class="toctree-l4" href="#282-solrcloud">28.2 连接到SolrCloud</a></li>
        
            <li><a class="toctree-l4" href="#283-solr-standalonehttp">28.3 连接到Solr Standalone(HTTP)</a></li>
        
            <li><a class="toctree-l4" href="#284-kerberos">28.4 Kerberos配置</a></li>
        
            <li><a class="toctree-l4" href="#285-solr">28.5 Solr架构设计</a></li>
        
            <li><a class="toctree-l4" href="#286">28.6 故障排除</a></li>
        
            <li><a class="toctree-l4" href="#287-solr">28.7 高级Solr配置</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../apache_lucene/">29.Apache_Lucene</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">V. 高级特性</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../advanced_topics/advanced_schema/">30.Advanced Schema</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/eventually_consistent_storage_backends/">31.最终一致的存储后端</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/failure_recovery/">32.失败 & 重试</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/index_management/">33.索引管理</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/bulk_loading/">34.批量加载</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/graph_partitioning/">35.图分区</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/datatype_and_attribute_serializer_configuration/">36.数据类型和属性序列化配置</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/janusgraph_with_tinkerPops_hadoop_gremlin/">37.JanusGraph基于TinkerPop's Hadoop-Gremlin使用</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/advanced_schema/">38.JanusGraph监控</a>
                </li>
                <li class="">
                    
    <a class="" href="../../advanced_topics/migrating_from_titan/">39.从Titan迁移</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">VI. JanusGraph内核</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../storage_backend/building_janusgraph/">40.JanusGraph数据模型</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage_backend/janusgraph_data_model/">41.构建JanusGraph</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">JanusGraph 翻译版(0.3.1)</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>IV. 后端索引 &raquo;</li>
        
      
    
    <li>28.Apache Solr</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="28-apache-solr">第28章 Apache Solr</h2>
<p>Solr是Apache Lucene项目中非常流行的、非常快速的开源企业搜索平台。Solr是一个独立的企业搜索服务器，具有类似rest的API。Solr是高度可靠、可伸缩和容错的，提供分布式索引、复制和负载平衡查询、自动故障转移和恢复、集中式配置等。
 -<a href="http://lucene.apache.org/solr/">Apache Solr主页</a></p>
<p>JanusGraph支持Apache Solr作为索引后端。以下是JanusGraph支持的一些Solr功能：
全文：支持所有Text谓词以搜索与给定单词，前缀或正则表达式匹配的文本属性。
- Geo：支持所有Geo谓词，以搜索在给定查询几何体中相交，内部，不相交或包含的地理属性。支持用于索引的点，线和多边形。支持圆，框和多边形用于查询点属性和所有形状以查询非点属性。
- 数字范围：支持所有数字比较Compare。
- TTL：支持自动使索引元素过期。
- 时间：毫秒粒度时间索引。
- 自定义分析器：选择使用自定义分析器。</p>
<p>有关Solr将与JanusGraph配合使用的详细信息，请参阅<a href="https://docs.janusgraph.org/latest/version-compat.html">附录B，版本兼容性</a>。</p>
<h3 id="281-solr">28.1 Solr配置概述</h3>
<p>JanusGraph支持Solr在SolrCloud或Solr Standalone（HTTP）配置中运行，以便与混合索引一起使用（请参见第11.1.2节“混合索引”）。通过参数配置所需的连接模式，该参数mode必须设置为cloud或者http，前者是默认值。例如，要明确指定Solr在SolrCloud配置中运行，请将以下属性指定为JanusGraph配置属性：</p>
<pre><code>index.search.solr.mode = cloud
</code></pre>

<p>这些是一些关键的Solr术语：
Core: 单台机器上的单个索引。
Configuration: solrconfig.xml， schema.xml和定义核心所需的其他文件。
Collection: 可以跨越不同计算机上的多个核心的单个逻辑索引。
Configset: 可由多个内核重用的共享配置。</p>
<h3 id="282-solrcloud">28.2 连接到SolrCloud</h3>
<p>通过将mode等于设置为连接到SolrCloud集群时，cloud必须指定Zookeeper URL（以及可选的端口），以便JanusGraph可以发现Solr集群并与之交互。</p>
<pre><code>index.search.backend=solr
index.search.solr.mode=cloud
index.search.solr.zookeeper-url=localhost:2181
</code></pre>

<p>与创建新集合相关的许多附加配置选项(仅在SolrCloud操作模式中受支持)可以配置为控制分片行为。有关这些选项的完整列表，请参阅<a href="https://docs.janusgraph.org/latest/config-ref.html">第15章 配置参考</a>。</p>
<p>SolrCloud利用Zookeeper在Solr服务器之间协调收集和配置信息。使用Zookeeper和SolrCloud可以显著减少使用Solr作为JanusGraph后端索引所需的手动配置量。</p>
<h4 id="2821-configset">28.2.1 Configset配置</h4>
<p>创建集合需要configset。configset存储在Zookeeper中，以便允许跨Solr服务器访问它。
- 每个集合在创建时都可以提供自己的configset，以便每个集合可以具有不同的配置。使用此方法，必须手动创建每个集合。
- 如果一个共享的configset将被多个集合重用，那么它可以单独上传到Zookeeper。使用这种方法，JanusGraph可以通过使用共享的configset自动创建集合。另一个好处是重用configset大大减少了存储在Zookeeper中的数据量。</p>
<h5 id="28211-configset">28.2.1.1 使用单个configset</h5>
<p>在本例中，使用发行版中找到的Solr的默认JanusGraph配置手动创建名为verticesByAge的集合。创建集合时，使用相同的集合名verticesByAge将配置上传到Zookeeper中。有关可用参数，请参阅<a href="https://lucene.apache.org/solr/guide/7_0/kerberos-authentication-plugin.html#define-a-jaas-configuration-file">Solr参考指南</a>。</p>
<pre><code># create the collection
$SOLR_HOME/bin/solr create -c verticesByAge -d $JANUSGRAPH_HOME/conf/solr
</code></pre>

<p>使用JanusGraphManagement相同的集合名称定义混合索引。</p>
<pre><code>mgmt = graph.openManagement()
age = mgmt.makePropertyKey(&quot;age&quot;).dataType(Integer.class).make()
mgmt.buildIndex(&quot;verticesByAge&quot;, Vertex.class).addKey(age).buildMixedIndex(&quot;search&quot;)
mgmt.commit()
</code></pre>

<h5 id="28212-configset">28.2.1.2 使用共享configset</h5>
<p>在使用共享configset时，最方便的方法是首先将配置作为一次性操作上载。在本例中，使用发行版中找到的Solr的默认JanusGraph配置，将名为JanusGraph -configset的configset上传到Zookeeper。有关可用参数，请参阅<a href="https://lucene.apache.org/solr/guide/6_6/solr-control-script-reference.html#SolrControlScriptReference-CollectionsandCores">Solr参考指南</a>。</p>
<pre><code># upload the shared configset into Zookeeper
# Solr 5
$SOLR_HOME/server/scripts/cloud-scripts/zkcli.sh -cmd upconfig -z localhost:2181 \
    -d $JANUSGRAPH_HOME/conf/solr -n janusgraph-configset
# Solr 6 and higher
$SOLR_HOME/bin/solr zk upconfig -d $JANUSGRAPH_HOME/conf/solr -n janusgraph-configset \
    -z localhost:2181
</code></pre>

<p>为JanusGraph配置SolrCloud索引后端时，请确保使用该index.search.solr.configset属性提供共享configset的名称。</p>
<pre><code>index.search.backend=solr
index.search.solr.mode=cloud
index.search.solr.zookeeper-url=localhost:2181
index.search.solr.configset=janusgraph-configset
</code></pre>

<p>使用JanusGraphManagement和集合名称定义混合索引。</p>
<pre><code>mgmt = graph.openManagement()
age = mgmt.makePropertyKey(&quot;age&quot;).dataType(Integer.class).make()
mgmt.buildIndex(&quot;verticesByAge&quot;, Vertex.class).addKey(age).buildMixedIndex(&quot;search&quot;)
mgmt.commit()
</code></pre>

<h3 id="283-solr-standalonehttp">28.3 连接到Solr Standalone(HTTP)</h3>
<p>通过设置mode等于http，通过HTTP连接到Solr Standalone时，必须提供Solr实例的单个或URL列表。</p>
<pre><code>index.search.backend=solr
index.search.solr.mode=http
index.search.solr.http-urls=http://localhost:8983/solr
</code></pre>

<p>用于控制最大连接数，连接超时和传输压缩的其他配置选项可用于HTTP模式。有关这些选项的完整列表，请参见<a href="https://docs.janusgraph.org/latest/config-ref.html">第15章 配置参考</a>。</p>
<h4 id="2831">28.3.1 核心配置</h4>
<p>Solr Standalone用于单个实例，它将配置信息保存在文件系统中。必须为每个混合索引手动创建核心。</p>
<p>要创建核心，需要一个core_name和一个configuration目录。有关可用参数，请参阅Solr参考指南。在本例中，使用发行版中找到的Solr的默认JanusGraph配置创建了一个名为verticesByAge的核心。</p>
<pre><code>$SOLR_HOME/bin/solr create -c verticesByAge -d $JANUSGRAPH_HOME/conf/solr
</code></pre>

<p>使用JanusGraphManagement相同的核心名称定义混合索引。</p>
<pre><code>mgmt = graph.openManagement()
age = mgmt.makePropertyKey(&quot;age&quot;).dataType(Integer.class).make()
mgmt.buildIndex(&quot;verticesByAge&quot;, Vertex.class).addKey(age).buildMixedIndex(&quot;search&quot;)
mgmt.commit()
</code></pre>

<h3 id="284-kerberos">28.4 Kerberos配置</h3>
<p>在连接到受Kerberos保护的Solr环境时，必须指定使用的Kerberos，并引用JAAS配置文件来正确配置Solr客户机。在使用Kerberos时，无论Solr以何种模式运行(SolrCloud或Solr独立运行)，都需要这种配置。</p>
<pre><code>index.search.solr.kerberos-enabled=true
</code></pre>

<p>通过设置java.security.auth.login.config的绝对路径来确保提供JAAS配置文件。应使用JVM选项设置此属性。例如，要运行，gremlin.sh您需要JAVA_OPTIONS在运行脚本之前设置环境变量：</p>
<pre><code>---
export JAVA_OPTIONS=&quot;-Djava.security.auth.login.config=/absolute/path/jaas.conf&quot;
$JANUSGRAPH_HOME/bin/gremlin.sh
---
</code></pre>

<p>有关JAAS配置文件中所需内容的详细信息，请参阅<a href="https://lucene.apache.org/solr/guide/7_0/kerberos-authentication-plugin.html#define-a-jaas-configuration-file">Solr参考指南</a>。</p>
<h3 id="285-solr">28.5 Solr架构设计</h3>
<h4 id="2851">28.5.1 动态字段定义</h4>
<p>默认情况下，JanusGraph使用Solr的动态字段功能来定义所有索引键的字段类型。将属性键添加到Solr支持的混合索引时，这不需要额外配置，并且提供比无模式模式更好的性能。</p>
<p>JanusGraph假设在支持Solr集合的schema.xml文件中定义了以下动态字段标记。请注意，solr schema.xml文件中还需要以下字段的附加xml定义才能使用它们。有关详细信息，请参阅JanusGraph安装中./conf/solr/schema.xml目录中提供的示例schema.xml文件。</p>
<pre><code>   &lt;dynamicField name=&quot;*_i&quot;    type=&quot;int&quot;          indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_s&quot;    type=&quot;string&quot;       indexed=&quot;true&quot;  stored=&quot;true&quot; /&gt;
   &lt;dynamicField name=&quot;*_l&quot;    type=&quot;long&quot;         indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_t&quot;    type=&quot;text_general&quot; indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_b&quot;    type=&quot;boolean&quot;      indexed=&quot;true&quot; stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_f&quot;    type=&quot;float&quot;        indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_d&quot;    type=&quot;double&quot;       indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_g&quot;    type=&quot;geo&quot;          indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_dt&quot;   type=&quot;date&quot;         indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
   &lt;dynamicField name=&quot;*_uuid&quot; type=&quot;uuid&quot;         indexed=&quot;true&quot;  stored=&quot;true&quot;/&gt;
</code></pre>

<p>在JanusGraph的默认配置中，属性键名称不必以类型相应的后缀结束，以便利用Solr的动态字段功能。JanusGraph通过对属性键定义的数字标识符和类型相应的后缀进行编码，从属性键名称生成Solr字段名称。这意味着JanusGraph在幕后使用具有类型相应后缀的合成字段名称，而不管使用JanusGraph的应用程序代码定义和使用的属性键名称。可以通过非默认配置覆盖此字段名称映射。这将在下一节中描述。</p>
<h4 id="2852">28.5.2 手动字段定义</h4>
<p>如果用户宁愿手动为集合中的每个索引字段定义字段类型，则需要禁用dyn-fields配置选项。在将属性键添加到索引之前，必须在支持Solr架构中定义每个索引属性键的字段。</p>
<p>在此场景中，建议启用字段映射的显式属性键名，以便修复字段名的显式定义。这可以通过两种方法之一来实现：
- 在向索引添加属性键时，通过提供mapped-name参数配置字段名。。有关更多信息，请参见<a href="https://docs.janusgraph.org/latest/field-mapping.html#index-local-field-mapping">第25.1节 单个字段映射</a>。
- 通过为Solr索引启用map-name配置选项，该选项将使用属性键名作为Solr中的字段名。。有关更多信息，请参见<a href="https://docs.janusgraph.org/latest/field-mapping.html#index-global-field-mapping">第25.2节 全局字段映射</a>。</p>
<h4 id="2853-schemaless-mode">28.5.3. Schemaless Mode</h4>
<p>JanusGraph还可以与为 Schemaless  Mode配置的SolrCloud集群进行交互。在这种情况下，应禁用dyn-fields配置选项，因为Solr将从值而不是字段名称推断字段类型。</p>
<p>但请注意，Schemaless Mode仅建议用于原型设计和初始应用程序开发，不建议用于生产用途。</p>
<h3 id="286">28.6 故障排除</h3>
<h4 id="2861">28.6.1 集合不存在</h4>
<p>在定义可以使用集合的索引之前，必须初始化集合(以及所有必需的配置文件)。有关更多信息，请参见连接到SolrCloud。</p>
<p>使用SolrCloud时，Zookeeper zkCli.sh命令行工具可用于检查加载到Zookeeper中的配置。还要验证默认的JanusGraph配置文件是否已复制到solr下的正确位置，以及复制文件的目录是否正确。</p>
<h4 id="2862-configset">28.6.2 找不到指定的Configset</h4>
<p>使用SolrCloud时，需要一个configset来为JanusGraph创建一个混合索引。有关更多信息，请参阅Configset配置。</p>
<ul>
<li>如果使用单个配置集，则必须首先手动创建集合。</li>
<li>如果使用共享配置集，则必须首先将配置集上载到Zookeeper。</li>
</ul>
<p>您可以验证配置集及其配置文件是否位于Zookeeper中/configs。有关其他Zookeeper操作，请参阅“ Solr参考指南”。</p>
<pre><code># verify the configset in Zookeeper
# Solr 5
$SOLR_HOME/server/scripts/cloud-scripts/zkcli.sh -cmd list -z localhost:2181
# Solr 6 and higher
$SOLR_HOME/bin/solr zk ls -r /configs/configset-name -z localhost:2181
</code></pre>

<h4 id="2863-http-404">28.6.3 HTTP 404错误</h4>
<p>使用Solr Standalone（HTTP）模式时可能会遇到此错误。错误的一个例子：</p>
<pre><code>20:01:22 ERROR org.janusgraph.diskstorage.solr.SolrIndex  - Unable to save documents
to Solr as one of the shape objects stored were not compatible with Solr.
org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server
at http://localhost:8983/solr: Expected mime type application/octet-stream but got text/html.
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;charset=utf-8&quot;/&gt;
&lt;title&gt;Error 404 Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;&lt;h2&gt;HTTP ERROR 404&lt;/h2&gt;
&lt;p&gt;Problem accessing /solr/verticesByAge/update. Reason:
&lt;pre&gt;    Not Found&lt;/pre&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>在尝试将数据存储到索引之前，请确保手动创建核心。有关更多信息，请参阅核心配置。</p>
<h4 id="2864">28.6.4 核心或集合名称无效</h4>
<p>核心或集合名称是标识符。它必须完全由句号，下划线，连字符和/或字母数字组成，也可能不以连字符开头。</p>
<h4 id="2865">28.6.5 连接问题</h4>
<p>无论操作模式如何，Solr实例或Solr实例集群必须正在运行并可从JanusGraph实例访问，以便JanusGraph将Solr用作索引后端。检查Solr集群是否正常运行，并且它是可见的，并且可以通过网络（或本地）从JanusGraph实例访问。</p>
<h4 id="2866-jts-classnotfoundexception">28.6.6 带有地理数据的JTS ClassNotFoundException</h4>
<p>Solr依靠Spatial4j进行地理处理。Spatial4j声明了对JTS的可选依赖（“JTS拓扑套件”）。某些地理字段定义和查询功能需要JTS。如果JTS jar不在Solr守护程序的类路径上，并且schema.xml中的字段使用地理类型，则Solr可能会在其中一个缺少的JTS类上抛出ClassNotFoundException。使用旨在与JanusGraph一起使用的schema.xml文件启动Solr时会出现异常，但CREATE在Solr CoreAdmin API中调用时也会出现异常。虽然根本原因是相同的，但客户端和服务器端的格式略有不同。</p>
<p>以下是Solr服务器日志的代表示例：</p>
<pre><code>ERROR [http-8983-exec-5] 2014-10-07 02:54:06, 665 SolrCoreResourceManager.java (line 344) com/vividsolutions/jts/geom/Geometry
java.lang.NoClassDefFoundError: com/vividsolutions/jts/geom/Geometry
        at com.spatial4j.core.context.jts.JtsSpatialContextFactory.newSpatialContext(JtsSpatialContextFactory.java:30)
        at com.spatial4j.core.context.SpatialContextFactory.makeSpatialContext(SpatialContextFactory.java:83)
        at org.apache.solr.schema.AbstractSpatialFieldType.init(AbstractSpatialFieldType.java:95)
        at org.apache.solr.schema.AbstractSpatialPrefixTreeFieldType.init(AbstractSpatialPrefixTreeFieldType.java:43)
        at org.apache.solr.schema.SpatialRecursivePrefixTreeFieldType.init(SpatialRecursivePrefixTreeFieldType.java:37)
        at org.apache.solr.schema.FieldType.setArgs(FieldType.java:164)
        at org.apache.solr.schema.FieldTypePluginLoader.init(FieldTypePluginLoader.java:141)
        at org.apache.solr.schema.FieldTypePluginLoader.init(FieldTypePluginLoader.java:43)
        at org.apache.solr.util.plugin.AbstractPluginLoader.load(AbstractPluginLoader.java:190)
        at org.apache.solr.schema.IndexSchema.readSchema(IndexSchema.java:470)
        at com.datastax.bdp.search.solr.CassandraIndexSchema.readSchema(CassandraIndexSchema.java:72)
        at org.apache.solr.schema.IndexSchema.&lt;init&gt;(IndexSchema.java:168)
        at com.datastax.bdp.search.solr.CassandraIndexSchema.&lt;init&gt;(CassandraIndexSchema.java:54)
        at com.datastax.bdp.search.solr.core.CassandraCoreContainer.create(CassandraCoreContainer.java:210)
        at com.datastax.bdp.search.solr.core.SolrCoreResourceManager.createCore(SolrCoreResourceManager.java:256)
        at com.datastax.bdp.search.solr.handler.admin.CassandraCoreAdminHandler.handleCreateAction(CassandraCoreAdminHandler.java:117)
</code></pre>

<p>以下是通常出现在CREATE向CoreAdmin API 发出相关命令的客户端输出中的内容</p>
<pre><code>org.apache.solr.common.SolrException: com/vividsolutions/jts/geom/Geometry
        at com.datastax.bdp.search.solr.core.SolrCoreResourceManager.createCore(SolrCoreResourceManager.java:345)
        at com.datastax.bdp.search.solr.handler.admin.CassandraCoreAdminHandler.handleCreateAction(CassandraCoreAdminHandler.java:117)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:152)
        ...
</code></pre>

<p>这可以通过将JTS jar添加到JanusGraph和/或Solr服务器的类路径来解决。由于其LGPL许可证，JTS默认不包含在JanusGraph发行版中。用户必须单独下载JTS jar文件并将其复制到JanusGraph和/或Solr服务器lib目录中。如果使用Solr的内置Web服务器，可以将JTS jar复制到示例/solr-webapp/webapp/WEB-INF/ lib目录以将其包含在类路径中。Solr可以重新启动，异常应该消失。首先必须使用正确的schema.xml文件启动Solr，以便存在示例/solr-webapp/webapp/WEB-INF/lib目录。</p>
<p>要确定Solr服务器的理想JTS版本，首先检查Solr集群使用的Spatial4j的版本，然后确定编译Spatial4j版本的JTS版本。Spatial4j 在com.spatial4j:spatial4j工件的pom中声明其目标JTS版本。将JTS jar复制到solr安装中的server/solr-webapp/webapp/WEB-INF/lib目录。</p>
<h3 id="287-solr">28.7 高级Solr配置</h3>
<h4 id="2871-dse">28.7.1 DSE搜索</h4>
<p>本节介绍JanusGraph与DataStax Enterprise（DSE）搜索的安装和配置。有多种方法可以安装DSE，但本节重点介绍DSE在Linux上的二进制tarball安装选项。本节中的大多数步骤可以推广到DSE的其他安装选项。</p>
<p>按照页面的指示安装DataStax Enterprise使用二进制tarball安装DataStax Enterprise。</p>
<p>导出DSE_HOME并附加到PATH shell环境中。以下是使用Bash语法的示例：</p>
<pre><code>export DSE_HOME=/path/to/dse-version.number
export PATH=&quot;$DSE_HOME&quot;/bin:&quot;$PATH&quot;
</code></pre>

<p>为Solr安装JTS。适当的版本因Spatial4j版本而异。从DSE 4.5.2开始，适当的版本是1.13。</p>
<pre><code>cd $DSE_HOME/resources/solr/lib
curl -O 'http://central.maven.org/maven2/com/vividsolutions/jts/1.13/jts-1.13.jar'
</code></pre>

<p>在单个后台守护程序中启动DSE Cassandra和Solr：</p>
<pre><code># The &quot;dse-data&quot; path below was chosen to match the
# &quot;Installing DataStax Enterprise using the binary tarball&quot;
# documentation page from DataStax.  The exact path is not
# significant.
dse cassandra -s -Ddse.solr.data.dir=&quot;$DSE_HOME&quot;/dse-data/solr
</code></pre>

<p>上一个命令会将一些启动信息写入控制台和日志文件路径$DSE_HOME/resources/cassandra/conf/log4j-server.properties的log4j.appender.R.File的配置。</p>
<p>一旦使用Cassandra和Solr的DSE正常启动，请检查群集运行状况nodetool status。单实例环应该显示一个节点带有标志 <em>U</em>p 和 <em>N</em>ormal:</p>
<pre><code>nodetool status
Note: Ownership information does not include topology; for complete information, specify a keyspace
= Datacenter: Solr
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address    Load       Owns   Host ID                               Token                                    Rack
UN  127.0.0.1  99.89 KB   100.0%  5484ef7b-ebce-4560-80f0-cbdcd9e9f496  -7317038863489909889                     rack1
</code></pre>

<p>接下来，切换到Gremlin Console并针对DSE实例打开JanusGraph数据库。这将创建JanusGraph的键空间和列族。</p>
<pre><code>cd $JANUSGRAPH_HOME
bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
gremlin&gt; graph = JanusGraphFactory.open('conf/janusgraph-cql-solr.properties')
==&gt;janusgraph[cql:[127.0.0.1]]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[janusgraph[cql:[127.0.0.1]], standard]
gremlin&gt;
</code></pre>

<p>保持这个Gremlin控制台打开。我们现在休息一下安装一个Solr核心。然后我们将回到此控制台以加载一些示例数据。</p>
<p>接下来，上传JanusGraph的Solr集合的配置文件，然后在DSE中创建核心：</p>
<pre><code># Change to the directory where JanusGraph was extracted.  Later commands
# use relative paths to the Solr config files shipped with the JanusGraph
# distribution.
cd $JANUSGRAPH_HOME

# The name must be URL safe and should contain one dot/full-stop
# character. The part of the name after the dot must not conflict with
# any of JanusGraph's internal CF names.  Starting the part after the dot
# &quot;solr&quot; will avoid a conflict with JanusGraph's internal CF names.
CORE_NAME=janusgraph.solr1
# Where to upload collection configuration and send CoreAdmin requests.
SOLR_HOST=localhost:8983

# The value of index.[X].solr.http-urls in JanusGraph's config file
# should match $SOLR_HOST and $CORE_NAME.  For example, given the
# $CORE_NAME and $SOLR_HOST values above, JanusGraph's config file would
# contain (assuming &quot;search&quot; is the desired index alias):
#
# index.search.solr.http-urls=http://localhost:8983/solr/janusgraph.solr1
#
# The stock JanusGraph config file conf/janusgraph-cql-solr.properties
# ships with this http-urls value.

# Upload Solr config files to DSE Search daemon
for xml in conf/solr/{solrconfig, schema, elevate}.xml ; do
    curl -v http://&quot;$SOLR_HOST&quot;/solr/resource/&quot;$CORE_NAME/$xml&quot; \
      --data-binary @&quot;$xml&quot; -H 'Content-type:text/xml; charset=utf-8'
done
for txt in conf/solr/{protwords, stopwords, synonyms}.txt ; do
    curl -v http://&quot;$SOLR_HOST&quot;/solr/resource/&quot;$CORE_NAME/$txt&quot; \
      --data-binary @&quot;$txt&quot; -H 'Content-type:text/plain; charset=utf-8'
done
sleep 5

# Create core using the Solr config files just uploaded above
curl &quot;http://&quot;$SOLR_HOST&quot;/solr/admin/cores?action=CREATE&amp;name=$CORE_NAME&quot;
sleep 5

# Retrieve and print the status of the core we just created
curl &quot;http://localhost:8983/solr/admin/cores?action=STATUS&amp;core=$CORE_NAME&quot;
</code></pre>

<p>现在，JanusGraph数据库和支持Solr核心已经可以使用了。我们可以使用God of the Gods 数据集对其进行测试。从上面开始拾取Gremlin控制台会话：</p>
<pre><code>// Assuming graph = JanusGraphFactory.open('conf/janusgraph-cql-solr.properties')...
gremlin&gt; GraphOfTheGodsFactory.load(graph)
==&gt;null
</code></pre>

<p>现在我们可以运行第3章“ 入门”中描述的任何查询。Solr将提供涉及文本和地理谓词的查询。有关JanusGraph和Solr客户端的更详细报告，运行gremlin.sh -l DEBUG并发出一些索引支持的查询。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../apache_lucene/" class="btn btn-neutral float-right" title="29.Apache_Lucene">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../elasticsearch/" class="btn btn-neutral" title="27.Elasticsearch"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../elasticsearch/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../apache_lucene/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
